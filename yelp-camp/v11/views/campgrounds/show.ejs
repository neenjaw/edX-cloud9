<% include ../partials/header %>

<% include ../partials/nav %>

<div class="container">
  
  <% include ../partials/flash %>

  <div class="row">
    <div class="col-md-3">
      <!-- <p class="lead">YelpCamp</p> -->
      <div class="list-group mb-3">
        <li class="list-group-item active">Location:<br><%= campground.location %></li>
        <li class="list-group-item">Info 2</li>
        <li class="list-group-item">Info 3</li>
      </div>
      <div id="map"></div>
    </div>
    <div class="col-md-9">

      <div class="card mb-3">
        <img class="card-img-top" src="<%= campground.image %>" alt="A picture of <%= campground.name %>">
        <div class="card-body">
          <h5 class="float-right">$<%= campground.price %>/night</h5>
          <h4 class="card-title"><a href="#"><%= campground.name %></a></h4>
          <p class="card-text"><%= campground.description %></p>
          <p class="card-text">
            <small class="text-muted">
              <% if (!campground.updated) { %>
                Posted <%= moment(campground.created).fromNow() %>
              <% } else { %>
                Last updated <%= moment(campground.updated).fromNow() %>
              <% } %>
                by <%= campground.author.name %>
            </small>
            <div>
              <% if (user && (campground.author.id.equals(user.id) || user.isAdmin)) { %>
                <form class="pl-1 float-right" action="/campgrounds/<%= campground.id %>?_method=DELETE" method="POST">
                  <button class="btn btn-sm btn-danger"><i class="fas fa-times"></i> Delete</button>
                </form>
                
                <a class="btn btn-sm btn-warning float-right" href="/campgrounds/<%= campground.id %>/edit"><i class="fas fa-edit"></i> Edit</a>
              <% } %>
            </div>
          </p>
        </div>
        <div class="card-footer">
          <div class="text-right">
            <a class="btn btn-success" href="/campgrounds/<%= campground.id %>/comments/new"><i class="fas fa-plus"></i> Add new Comment</a>
          </div>
          <hr>
          <% campground.comments.forEach((comment, index) => { %>
          <div class="row">
            <div class="col-md-12">
              <h6>
                <span>★★★★☆</span>
                <small class="float-right text-muted">
                  <% if (!comment.updated) { %>
                    Posted <%= moment(comment.created).fromNow() %>
                  <% } else { %>
                    Last updated <%= moment(comment.updated).fromNow() %>
                  <% } %>
                </small>
              </h6>
              <p>
                "<%= comment.text %>"
              </p>
              <div class="clearfix">
                <span><i class="fas fa-user"></i> <%= comment.author.name %></span>
                <% if (user && (comment.author.id.equals(user.id) || user.isAdmin)) { %>
                  <form class="pl-1 float-right pl-1" action="/campgrounds/<%= campground.id %>/comments/<%= comment.id %>?_method=DELETE" method="POST">
                    <button class="btn btn-sm btn-danger"><i class="fas fa-times"></i> Delete</button>
                  </form>
                  <a class="btn btn-sm btn-warning float-right" href="/campgrounds/<%= campground.id %>/comments/<%= comment.id %>/edit"><i class="fas fa-edit"></i> Edit</a>
                <% } %>
              </div>
              <% if (index < (campground.comments.length - 1)) { %>
              <hr>
              <% } %>
            </div>
          </div>
          <% }); %>
          
          
        </div>
      </div>



    </div>
  </div>

</div>

<script>
  function initMap() {
    const lat = <%= campground.lat %>;
    const lng = <%= campground.lng %>;
    const center = {lat: lat, lng: lng };
    const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 8,
        center: center,
        scrollwheel: false
    });
    const contentString = `
      <strong><%= campground.name %><br />
      <%= campground.location %></strong>
      <p><%= campground.description %></p>
    `
    const infowindow = new google.maps.InfoWindow({
      content: contentString
    });
    const marker = new google.maps.Marker({
        position: center,
        map: map
    });
    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });
  }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBrm_RmAl9BVvUsu-H5uf-FqWo1xvleTg&callback=initMap"></script>

<% include ../partials/footer %>
